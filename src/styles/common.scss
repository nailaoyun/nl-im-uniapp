/**
 * 公共样式
 * 包含布局、动画、工具类
 */

// ==========================================
// 关键帧动画
// ==========================================

// 淡入上滑动画
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20rpx);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// 弹入动画
@keyframes popIn {
  from {
    transform: scale(0.95);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

// 滑入动画
@keyframes slideUp {
  from {
    transform: translateY(100%);
  }
  to {
    transform: translateY(0);
  }
}

// 滑出动画
@keyframes slideDown {
  from {
    transform: translateY(0);
  }
  to {
    transform: translateY(100%);
  }
}

// 波形动画 (语音消息)
@keyframes wave {
  0%, 100% {
    height: 8rpx;
  }
  50% {
    height: 32rpx;
  }
}

// 脉冲动画 (通话指示器)
@keyframes pulse-ring {
  0% {
    transform: scale(0.8);
    opacity: 0.5;
  }
  100% {
    transform: scale(1.3);
    opacity: 0;
  }
}

// 涟漪动画 (来电头像)
@keyframes ripple {
  0% {
    transform: scale(1);
    opacity: 0.4;
  }
  100% {
    transform: scale(2.5);
    opacity: 0;
  }
}

// 呼吸动画
@keyframes breathing {
  0%, 100% {
    opacity: 0.6;
  }
  50% {
    opacity: 1;
  }
}

// 弹跳动画
@keyframes bounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-4rpx);
  }
}

// ==========================================
// 过渡和动画工具类
// ==========================================

.smooth-transition {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.fast-transition {
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-fade-in-up {
  animation: fadeInUp 0.4s ease-out forwards;
}

.animate-pop-in {
  animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

.animate-slide-up {
  animation: slideUp 0.3s ease-out forwards;
}

.animate-pulse {
  animation: breathing 2s ease-in-out infinite;
}

// 动画延迟
.delay-50 { animation-delay: 50ms; }
.delay-100 { animation-delay: 100ms; }
.delay-150 { animation-delay: 150ms; }
.delay-200 { animation-delay: 200ms; }
.delay-300 { animation-delay: 300ms; }

// ==========================================
// 滚动条隐藏
// ==========================================

.custom-scrollbar {
  &::-webkit-scrollbar {
    display: none;
  }
  -ms-overflow-style: none;
  scrollbar-width: none;
}

// ==========================================
// 毛玻璃效果
// ==========================================

.glass-effect {
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);

  .dark & {
    background: rgba(28, 25, 23, 0.85);
  }
}

.glass-light {
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

// ==========================================
// 安全区域
// ==========================================

:root {
  // 状态栏高度 - UniApp 会自动注入
  --status-bar-height: var(--status-bar-height, 44px);
  // 安全区域
  --safe-area-top: env(safe-area-inset-top, 0px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-left: env(safe-area-inset-left, 0px);
  --safe-area-right: env(safe-area-inset-right, 0px);
  // 微信小程序额外安全距离（胶囊按钮区域）
  // 默认值：胶囊按钮高度约32px，上下间距约8px，总计约48px
  --mp-safe-top: 0px;
  // 微信小程序导航栏内容高度（不含状态栏）
  --mp-navbar-height: 44px;
}

/* #ifdef MP-WEIXIN */
page {
  // 微信小程序：状态栏 + 导航栏区域
  // 胶囊按钮通常距状态栏底部约 4-8px，高度约 32px
  // 导航栏高度 = (胶囊top - 状态栏高度) * 2 + 胶囊高度 ≈ 8 * 2 + 32 = 48px
  --mp-safe-top: 8px; // 胶囊按钮上方间距
  --mp-navbar-height: 48px; // 导航栏内容区高度
}
/* #endif */

.safe-area-top {
  /* #ifdef MP-WEIXIN */
  padding-top: calc(var(--status-bar-height, 44px) + 95rpx);
  /* #endif */

  /* #ifndef MP-WEIXIN */
  padding-top: var(--status-bar-height, 0);
  /* #endif */
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}

// 安全区域占位
.safe-area-spacer {
  height: calc(160rpx + env(safe-area-inset-bottom));
}

// 微信小程序导航栏占位（含状态栏 + 导航栏）
.mp-navbar-spacer {
  height: calc(var(--status-bar-height, 0) + var(--mp-navbar-height, 44px));
}

// 响应式断点
@mixin respond-to($breakpoint) {
  @if $breakpoint == 'sm' {
    @media (max-width: 375px) { @content; }
  }
  @else if $breakpoint == 'md' {
    @media (min-width: 376px) and (max-width: 414px) { @content; }
  }
  @else if $breakpoint == 'lg' {
    @media (min-width: 415px) { @content; }
  }
}

// ==========================================
// Flex 布局
// ==========================================

.flex {
  display: flex;
}

.flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

.flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.flex-column {
  display: flex;
  flex-direction: column;
}

.flex-1 {
  flex: 1;
}

.flex-shrink-0 {
  flex-shrink: 0;
}

.items-center {
  align-items: center;
}

.items-start {
  align-items: flex-start;
}

.items-end {
  align-items: flex-end;
}

.justify-center {
  justify-content: center;
}

.justify-between {
  justify-content: space-between;
}

.justify-end {
  justify-content: flex-end;
}

// ==========================================
// 文本
// ==========================================

.text-ellipsis {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.text-center {
  text-align: center;
}

.text-primary {
  color: var(--color-primary);
}

.text-danger {
  color: var(--color-danger);
}

.text-secondary {
  color: var(--text-secondary);
}

.text-tertiary {
  color: var(--text-tertiary);
}

.font-bold {
  font-weight: 700;
}

.font-medium {
  font-weight: 500;
}

// ==========================================
// 边距
// ==========================================

.m-0 { margin: 0; }
.mt-10 { margin-top: 10rpx; }
.mt-20 { margin-top: 20rpx; }
.mt-30 { margin-top: 30rpx; }
.mb-10 { margin-bottom: 10rpx; }
.mb-20 { margin-bottom: 20rpx; }
.mb-30 { margin-bottom: 30rpx; }
.ml-10 { margin-left: 10rpx; }
.mr-10 { margin-right: 10rpx; }

.p-0 { padding: 0; }
.p-20 { padding: 20rpx; }
.p-30 { padding: 30rpx; }
.px-20 { padding-left: 20rpx; padding-right: 20rpx; }
.px-30 { padding-left: 30rpx; padding-right: 30rpx; }
.py-20 { padding-top: 20rpx; padding-bottom: 20rpx; }

// ==========================================
// 圆角规范
// ==========================================

.rounded-sm { border-radius: 8rpx; }
.rounded { border-radius: 16rpx; }
.rounded-lg { border-radius: 20rpx; }
.rounded-xl { border-radius: 24rpx; }
.rounded-2xl { border-radius: 32rpx; }
.rounded-3xl { border-radius: 40rpx; }
.rounded-full { border-radius: 50%; }

// ==========================================
// 阴影规范
// ==========================================

.shadow-sm {
  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);
}

.shadow {
  box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.08);
}

.shadow-lg {
  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.1);
}

.shadow-xl {
  box-shadow: 0 16rpx 48rpx rgba(0, 0, 0, 0.15);
}

// ==========================================
// 页面容器
// ==========================================

.page-container {
  min-height: 100vh;
  background: var(--bg-page);
}

// ==========================================
// 卡片
// ==========================================

.card {
  background: var(--bg-content);
  border-radius: 20rpx;
  margin: 20rpx;
  overflow: hidden;
}

// ==========================================
// 分割线
// ==========================================

.divider {
  height: 1rpx;
  background: var(--divider-color);
  margin: 0 30rpx;
}

// ==========================================
// 头像占位
// ==========================================

.avatar-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--avatar-bg);
  color: var(--avatar-text);
  font-weight: 600;
}

// ==========================================
// 空状态
// ==========================================

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 100rpx 0;
  color: var(--text-tertiary);
}

// ==========================================
// 加载状态
// ==========================================

.loading-state {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 60rpx;
  color: var(--text-tertiary);
}

// ==========================================
// 自定义导航栏
// ==========================================

.custom-navbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  background: var(--nav-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1rpx solid var(--border-subtle);

  /* #ifdef MP-WEIXIN */
  // 微信小程序：状态栏 + 胶囊按钮区域
  padding-top: calc(var(--status-bar-height, 44px) + 20rpx);
  /* #endif */

  /* #ifndef MP-WEIXIN */
  // H5/App：仅状态栏高度
  padding-top: var(--status-bar-height, 0);
  /* #endif */

  .navbar-content {
    display: flex;
    align-items: center;
    height: var(--mp-navbar-height, 88rpx);
    padding: 0 32rpx;

    /* #ifdef MP-WEIXIN */
    // 微信小程序：避开右侧胶囊按钮，预留约 100px 空间
    padding-right: 200rpx;
    /* #endif */
  }

  .navbar-title {
    flex: 1;
    font-size: 40rpx;
    font-weight: 700;
    color: var(--text-primary);
  }

  .navbar-left,
  .navbar-right {
    display: flex;
    align-items: center;
  }
}

// ==========================================
// 底部安全区
// ==========================================

.bottom-safe-area {
  padding-bottom: calc(20rpx + env(safe-area-inset-bottom));
}

// ==========================================
// 浮动按钮
// ==========================================

.fab {
  position: fixed;
  right: 40rpx;
  bottom: calc(180rpx + env(safe-area-inset-bottom));
  width: 112rpx;
  height: 112rpx;
  border-radius: 50%;
  background: #10b981;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 10rpx 30rpx rgba(16, 185, 129, 0.3);
  z-index: 99;
  transition: transform 0.2s;

  &:active {
    transform: scale(0.95);
  }
}

// ==========================================
// 图标按钮
// ==========================================

.icon-btn {
  width: 72rpx;
  height: 72rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.15s;

  &:active {
    background: var(--bg-hover);
    opacity: 0.7;
  }
}

// ==========================================
// 点击反馈
// ==========================================

.clickable {
  transition: all 0.15s;

  &:active {
    opacity: 0.7;
  }
}

.pressable {
  transition: transform 0.15s;

  &:active {
    transform: scale(0.95);
  }
}

// ==========================================
// 遮罩层
// ==========================================

.mask-enter {
  opacity: 0;
  pointer-events: none;
}

.mask-active {
  opacity: 1;
  pointer-events: auto;
}

// ==========================================
// 抽屉动画
// ==========================================

.drawer-enter {
  transform: translateX(-100%);
}

.drawer-active {
  transform: translateX(0);
}

// ==========================================
// 菜单动画
// ==========================================

.menu-enter {
  opacity: 0;
  transform: scale(0.95) translateY(-10rpx);
  pointer-events: none;
}

.menu-active {
  opacity: 1;
  transform: scale(1) translateY(0);
  pointer-events: auto;
}

// ==========================================
// 底部弹窗动画
// ==========================================

.bottom-sheet-enter {
  transform: translateY(100%);
}

.bottom-sheet-active {
  transform: translateY(0);
}

// ==========================================
// 波形可视化 (语音消息)
// ==========================================

.wave-visualizer {
  display: flex;
  align-items: center;
  gap: 4rpx;
  height: 32rpx;

  .wave-bar {
    width: 4rpx;
    height: 8rpx;
    background: currentColor;
    border-radius: 4rpx;
    transition: height 0.1s;

    &.animating {
      animation: wave 0.8s infinite ease-in-out;

      &:nth-child(1) { animation-delay: 0s; }
      &:nth-child(2) { animation-delay: 0.1s; }
      &:nth-child(3) { animation-delay: 0.2s; }
      &:nth-child(4) { animation-delay: 0.3s; }
    }
  }
}

// ==========================================
// 头像涟漪动画 (来电)
// ==========================================

.avatar-ripple {
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  inset: -20rpx;
  animation: ripple 2s infinite linear;

  &.delay {
    animation-delay: 0.5s;
  }
}

// ==========================================
// 脉冲指示器 (通话中)
// ==========================================

.pulse-indicator {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: inherit;
    animation: pulse-ring 2s infinite;
  }
}
